
<project name="setup-loader" basedir=".">
	
	<description>
        	SETUP LOADER
	</description>

	<import file="../../commons/utils.xml" />
	
	<!-- loader.properties -->
	<target name="loader_properties_settings">

		<concat destfile="${file}" append="yes" >

# ----- Personalizzazione Setup OpenSPCoop2 -------------
		</concat>

		<!-- WORKING DIR -->
		<antcall target="set_property">
		    <param name="file" value="${file}"/>
			<param name="token" value="confDirectory"/>
			<param name="value" value="${work_dir}"/>
		</antcall>
		
		<!-- 
		  PROTOCOL DEFAULT
		  Se è abilitato spcoop in backward compatibility è spcoop, 
		  altrimenti se abilitati verrano scelto nell'ordine:
		  - trasparente
		  - spcoop
		  - sdi
		-->
		<if>
			<and>
				<istrue value="${antinstaller_protocollo_spcoop}"/>
				<istrue value="${antinstaller_backward_compatibility}"/>
			</and>
			<then>
				<antcall target="set_property">
				    <param name="file" value="${file}"/>
					<param name="token" value="protocolloDefault"/>
					<param name="value" value="spcoop"/>
				</antcall>
			</then>
			<else>
				<if>
					<istrue value="${antinstaller_protocollo_trasparente}"/>
					<then>
						<antcall target="set_property">
						    <param name="file" value="${file}"/>
							<param name="token" value="protocolloDefault"/>
							<param name="value" value="trasparente"/>
						</antcall>
					</then>
					<else>
						<if>
							<istrue value="${antinstaller_protocollo_spcoop}"/>
							<then>
								<antcall target="set_property">
								    <param name="file" value="${file}"/>
									<param name="token" value="protocolloDefault"/>
									<param name="value" value="spcoop"/>
								</antcall>
							</then>
							<else>
								<if>
									<istrue value="${antinstaller_protocollo_sdi}"/>
									<then>
										<antcall target="set_property">
										    <param name="file" value="${file}"/>
											<param name="token" value="protocolloDefault"/>
											<param name="value" value="sdi"/>
										</antcall>
									</then>
								</if>
							</else>
						</if>
					</else>
				</if>
			</else>
		</if>
		
		<!-- LOG4J APPEND -->
		<antcall target="set_property">
		    <param name="file" value="${file}"/>
			<param name="token" value="appendLog4j"/>
			<param name="value" value="true"/>
		</antcall>
		
		<!-- OTHER -->
		<antcall target="set_property">
		    <param name="file" value="${file}"/>
			<param name="token" value="nomePddOperativa_CtrlstatSinglePdD"/>
			<param name="value" value="PdD${antinstaller_nomesoggetto}"/>
		</antcall>
		<antcall target="replace_token">
		    <param name="file" value="${file}"/>
			<param name="token" value="nomePddOperativa_CtrlstatSinglePdD"/>
			<param name="value" value="#nomePddOperativa_CtrlstatSinglePdD"/>
		</antcall>
		<antcall target="set_property">
		    <param name="file" value="${file}"/>
			<param name="token" value="tipoPdD"/>
			<param name="value" value="esterno"/>
		</antcall>
		
	</target>
	
	
	<!-- loader.datasource.properties -->
	<target name="loader_datasource_properties_settings">
		
		<concat destfile="${file}" append="yes" >

# ----- Personalizzazione Setup OpenSPCoop2 -------------
		</concat>
				
		<!-- TIPO DATABASE -->
		<antcall target="set_property">
		    <param name="file" value="${file}"/>
			<param name="token" value="registroServizi.tipoDatabase"/>
			<param name="value" value="${antinstaller_tipo_database}"/>
		</antcall>
		<antcall target="set_property">
		    <param name="file" value="${file}"/>
			<param name="token" value="configPdD.tipoDatabase"/>
			<param name="value" value="${antinstaller_tipo_database}"/>
		</antcall>
		
		<!-- DATASOURCE -->
		<antcall target="set_property">
		    <param name="file" value="${file}"/>
			<param name="token" value="registroServizi.dataSource"/>
			<param name="value" value="${datasource_console_name}"/>
		</antcall>
		<antcall target="set_property">
		    <param name="file" value="${file}"/>
			<param name="token" value="configPdD.dataSource"/>
			<param name="value" value="${datasource_console_name}"/>
		</antcall>
				
	</target>
	
	
	<!-- loader.log4j2.properties -->
	<target name="loader_log4j_properties_settings">
		
		<concat destfile="${file}" append="yes" >

# ----- Personalizzazione Setup OpenSPCoop2 -------------
		</concat>
		
		<!-- WORKING DIR -->
		<antcall target="replace_token">
		    <param name="file" value="${file}"/>
			<param name="token" value="/var/openspcoop2/log/"/>
			<param name="value" value="${work_dir}/log/"/>
		</antcall>
		
		<!-- TIPI DI LOG -->
		<antcall target="replace_token">
		    <param name="file" value="${file}"/>
			<param name="token" value="DEBUG"/>
			<param name="value" value="ERROR"/>
		</antcall>
	
	</target>
	
	<!-- log4j2.properties -->
	<target name="loader_default_log4j_properties_settings">
		
		<available file="${file}" property="file.present"/>
		
		<if>
			<istrue value="${file.present}"/>
			<then>
				<concat destfile="${file}" append="yes" >

# ----- Personalizzazione Setup OpenSPCoop2 -------------
				</concat>
				<!-- WORKING DIR -->
				<antcall target="replace_token">
				    <param name="file" value="${file}"/>
					<param name="token" value="/var/openspcoop2/log/"/>
					<param name="value" value="${work_dir}/log/"/>
				</antcall>
			</then>
		</if>
		
	</target>
		
</project>
